SELECT
    sc.id,
    sc.state,
    sc.deadlinetime,
    sc.statestarttime,
    sc.slatimer_ai,

    /* Сумма пауз в секундах (из SLATIMER_AI) */
    (
      SELECT NVL(SUM( (end_ms - start_ms) / 1000 ), 0)
      FROM (
        SELECT
          TO_NUMBER(REGEXP_SUBSTR(part, '^\d+')) AS start_ms,
          TO_NUMBER(REGEXP_SUBSTR(part, '\d+$')) AS end_ms
        FROM (
          SELECT REGEXP_SUBSTR(sc.slatimer_ai, '\d+-\d+', 1, LEVEL) AS part
          FROM dual
          CONNECT BY REGEXP_SUBSTR(sc.slatimer_ai, '\d+-\d+', 1, LEVEL) IS NOT NULL
        )
      )
    ) AS paused_seconds,

    /* Эффективный дедлайн = базовый дедлайн + суммарная пауза */
    sc.deadlinetime
      + NUMTODSINTERVAL(
          (
            SELECT NVL(SUM( (end_ms - start_ms) / 1000 ), 0)
            FROM (
              SELECT
                TO_NUMBER(REGEXP_SUBSTR(part, '^\d+')) AS start_ms,
                TO_NUMBER(REGEXP_SUBSTR(part, '\d+$')) AS end_ms
              FROM (
                SELECT REGEXP_SUBSTR(sc.slatimer_ai, '\d+-\d+', 1, LEVEL) AS part
                FROM dual
                CONNECT BY REGEXP_SUBSTR(sc.slatimer_ai, '\d+-\d+', 1, LEVEL) IS NOT NULL
              )
            )
          ),
          'SECOND'
        ) AS effective_deadline_by_ai

FROM nausd40.tbl_servicecall sc
WHERE sc.id = 223751730;
